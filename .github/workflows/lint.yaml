name: Lint and Test

"on":
  push:
    branches: [main]
  pull_request:

jobs:
  python-lint:
    name: Python Linting
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: "3.11"
          cache: 'pip'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install litellm boto3 azure-storage-blob tenacity==8.5.0
          pip install ruff pyright

      - name: Run ruff linting
        run: |
          ruff check ./

      - name: Run ruff formatting check
        run: |
          ruff format --check ./

      - name: Run pyright type checking
        run: |
          pyright ./

      - name: Run tests
        run: |
          python -m unittest discover ./

  shell-lint:
    name: Shell Script Linting
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Install shellcheck
        run: |
          sudo apt-get update
          sudo apt-get install -y shellcheck

      - name: Run shell script linting
        run: |
          find . -name "*.sh" | xargs shellcheck

  yaml-lint:
    name: YAML Linting
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: "3.11"

      - name: Install yamllint
        run: |
          python -m pip install --upgrade pip
          pip install yamllint

      - name: Run YAML linting
        run: |
          yamllint ./
